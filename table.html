<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Sistema de Registro de Clientes — Registros</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
<aside class="sidebar">
<span class="brand">Sistema de Registro de Clientes</span>
<a href="index.html">Novo cadastro</a>
<a href="table.html">Ver registros</a>
<a href="excluidos.html">Ver excluídos</a>
</aside>
<main class="main">
<div class="card">
<h1>Registros</h1>
<div class="row" style="justify-content:space-between;align-items:center;">
  <div class="row">
    <label><input id="select-all" type="checkbox"> Selecionar todos</label>
    <form action="/delete_selected" method="post" data-confirm="true" data-confirm-message="Deseja realmente excluir os registros selecionados?">
      <input type="hidden" name="ids" id="bulk-ids">
      <button class="btn" type="submit">Excluir selecionados</button>
    </form>
  </div>
  <div>
    <a class="btn ghost" href="/export/csv?office=all">Exportar CSV - Todas</a>
    <a class="btn ghost" href="/export/pdf?office=all" target="_blank">Exportar PDF - Todas</a>
  </div>
</div>

<div class="table-wrap" style="margin-top:12px;">
<form id="table-form" action="/delete_selected" method="post" data-confirm="true" data-confirm-message="Deseja realmente excluir os registros selecionados?">
<table>
<thead><tr><th></th><th>id</th><th>nome</th><th>cpf</th><th>escritório</th><th>tipo_acao</th><th>data_fechamento</th><th>pendencias</th><th>numero_processo</th><th>data_protocolo</th><th>observacoes</th><th>captador</th><th>created_at</th><th>Ações</th></tr></thead>
<tbody>
{% for r in rows %}
<tr>
  <td><input class="row-select" type="checkbox" name="id" value="{{ r['id'] }}"></td>
  <td>{{ r['id'] }}</td>
  <td>{{ r['nome'] }}</td>
  <td>{{ r['cpf'] }}</td>
  <td>{{ r['escritorio'] }}</td>
  <td>{{ r['tipo_acao'] }}</td>
  <td>{{ r['data_fechamento'] }}</td>
  <td>{{ r['pendencias'] }}</td>
  <td>{{ r['numero_processo'] }}</td>
  <td>{{ r['data_protocolo'] }}</td>
  <td>{{ r['observacoes'] }}</td>
  <td>{{ r['captador'] }}</td>
  <td>{{ r['created_at'] }}</td>
  <td>
    <form action="/delete" method="post" style="display:inline" data-confirm="true" data-confirm-message="Deseja realmente excluir este cliente?">
      <input type="hidden" name="id" value="{{ r['id'] }}">
      <input type="hidden" name="table" value="{{ office }}">
      <button class="btn ghost" type="submit">Excluir</button>
    </form>
  </td>
</tr>
{% endfor %}
</tbody>
</table>
</form>
</div>

<script>
// collect selected ids before submitting bulk delete
document.addEventListener('DOMContentLoaded', function(){
  const tableForm = document.getElementById('table-form');
  if(tableForm){
    tableForm.addEventListener('submit', function(e){
      const checked = Array.from(document.querySelectorAll('.row-select:checked')).map(cb=>cb.value);
      if(checked.length===0){ e.preventDefault(); alert('Nenhum registro selecionado'); return; }
      // create hidden input with comma separated ids
      const input = document.createElement('input');
      input.type='hidden'; input.name='ids'; input.value = checked.join(',');
      tableForm.appendChild(input);
    });
  }
});
</script>

</div>
</main>
</div>
<script src="script.js"></script>
</body></html>
